 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reading List</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/stats-timeline.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h1>Reading List</h1>

<div class="tabs">
    <button class="tab" data-tab="profile">Profile</button>
    <button class="tab active" data-tab="list">List</button>
    <button class="tab" data-tab="stats">Stats</button>
    <button class="tab" data-tab="timeline">Timeline</button>
    <button class="tab" data-tab="challenges">Challenges</button>
    <button class="tab" data-tab="quotes">Quotes</button>
    <button class="tab" data-tab="options">Options</button>
</div>

<section id="tab-list" class="tab-content active">
    <label>Filter by shelf: <select id="shelfFilter"></select></label>
    <button id="sortRecent" style="margin-left: 12px;">Sort by recent <span id="recentSortIndicator">‚ñº</span></button>
    <button id="addBook" style="margin-top:12px;">Add New Book</button>
    <label style="margin-left:15px">
        Search: <input type="text" id="searchInput" style="width:300px" placeholder="Search title, author, series or use filters">
        <span id="filterInfo">?</span>
    </label>
    <div id="yearGoalProgressContainer" style="margin:16px 0;"></div>
    <table>
        <thead>
            <tr>
                <th data-col="title">Title <span class="sort"></span></th>
                <th data-col="rating">Rating <span class="sort"></span></th>
                <th data-col="author">Author <span class="sort"></span></th>
                <th>Cover</th>
                <th data-col="shelves">Shelves <span class="sort"></span></th>
                <th data-col="pages">Pages <span class="sort"></span></th>
                <th data-col="year">Year <span class="sort"></span></th>
                <th data-col="lastRead">Last Read <span class="sort"></span></th>
                <th data-col="readCount">Reads <span class="sort"></span></th>
                <th>Edit</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</section>

<section id="tab-stats" class="tab-content">
    <div style="text-align:center; margin:20px 0;">
        <button id="openYearReview" style="font-size:1.1em; padding:10px 20px;">Generate Year in Review</button>
    </div>
    <div id="stats"></div>
    <div id="statsChartContainer"><canvas id="statsChart"></canvas></div>
    <div class="pie-charts-container">
        <div class="charts-grid">
            <div class="chart-wrapper">
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <canvas id="languageChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <canvas id="countryChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <canvas id="genreChart"></canvas>
            </div>
        </div>
    </div>
    <div id="cumulativeChartContainer"><canvas id="cumulativeChart"></canvas></div>
</section>

<section id="tab-profile" class="tab-content">
    <div id="profileContainer" style="max-width:800px; margin:auto;">
        <div style="display:flex; gap:16px; align-items:center; margin-bottom:16px;">
            <div>
                <img id="profilePic" src="https://placehold.co/100x100?text=?" alt="Profile Picture" style="width:100px;height:100px;object-fit:cover;border:2px solid #555; cursor:pointer; border-radius:50%;">
                <input type="file" id="profilePicInput" accept="image/*" style="display:none;">
            </div>
            <div style="flex:1;">
                <input type="text" id="profileNick" placeholder="Nickname" style="width:100%; margin-bottom:8px;">
                <textarea id="profileBio" placeholder="Bio" style="width:100%; height:80px; resize:vertical;"></textarea>
            </div>
        </div>
        <div id="profileStats"></div>
<div class="profile-recent-section">
    <h3>Quote of the Day</h3>
    <div id="quoteWidget" style="text-align:center; padding:16px; background:#1a1a1a; border:1px solid #333; border-radius:8px;">
        <p>Loading inspirational quote...</p>
    </div>
    <button id="refreshQuoteBtn" style="margin-top:8px;">New random quote</button>
</div> 
        <div class="profile-recent-section">
            <h3>Recent Activity</h3>
            <div id="recentBooksContainer" class="card-container"></div>
        </div>
        <div class="profile-recent-section">
            <h3>Favourites</h3>
            <div id="favouritesContainer" class="card-container"></div>
        </div>
    </div>
    <div class="profile-recent-section">
    <h3>Still waiting for you...</h3>
    <div id="waitingWidget" style="text-align:center; padding:16px; background:#1a1a1a; border:1px solid #333; border-radius:8px;">
        <p>Click Profile tab to discover a random to-read book!</p>
    </div>
    <button id="refreshWaitingBtn" style="margin-top:8px;">New random book</button>
</div>
    <div class="profile-recent-section">
    <h3>On this day</h3>
    <div id="onThisDayContainer" class="card-container"></div>
    <p id="onThisDayEmpty" style="color:#aaa; text-align:center; margin-top:8px;">No books finished on this day in past years.</p>
</div>
    <div class="profile-recent-section">
    <h3>Rediscover an old favourite</h3>
    <div id="rediscoverWidget" style="text-align:center; padding:16px; background:#1a1a1a; border:1px solid #333; border-radius:8px;">
        <p>Loading a gem from the past...</p>
    </div>
    <button id="refreshRediscoverBtn" style="margin-top:8px;">New rediscovery</button>
</div>
</section>

    <section id="tab-timeline" class="tab-content">
    <div id="timelineContainer"></div>
</section>

<section id="tab-challenges" class="tab-content">
    <h3>Yearly Goals</h3>
    <div id="goalsSection">
        <div class="goals-inline">
            <label>Year: <input type="number" id="goalYear" style="width:80px;"></label>
            <label>Books goal: <input type="number" id="yearBooksGoal" style="width:100px;"></label>
            <label>Pages goal: <input type="number" id="yearPagesGoal" style="width:100px;"></label>
            <button id="saveGoal">Save</button>
            <button id="removeGoal">Remove</button>
        </div>
    </div>

    <h3>Custom Challenges</h3>
    <div id="customChallengesForm" style="margin:20px 0; padding:15px; background:#1a1a1a; border:1px solid #333; border-radius:8px;">
        <label>Name: <input type="text" id="challengeName" placeholder="e.g. Horror Month" style="width:200px;"></label><br><br>
        <label>Description (optional): <textarea id="challengeDesc" placeholder="Details..." style="width:100%; height:60px;"></textarea></label><br><br>
        <label>Type: 
            <select id="challengeType">
                <option value="tag">Tag</option>
                <option value="author">Author</option>
                <option value="country">Country</option>
                <option value="series">Series</option>
                <option value="genre">Genre</option>
            </select>
        </label><br><br>
        <label>Value: <input type="text" id="challengeValue" placeholder="e.g. horror / Murakami / France / Dune" style="width:250px;"></label><br><br>
        <label>Target books: <input type="number" id="challengeTarget" min="1" value="5" style="width:80px;"></label><br><br>
        <label><input type="checkbox" id="challengeYearly"> Yearly challenge</label>
        <label id="challengeYearLabel" style="display:none; margin-left:20px;">
            Year: <input type="number" id="challengeYear" value="2026" style="width:80px;">
        </label><br><br>
        <button id="addChallenge">Add Challenge</button>
    </div>

    <h4>Your Challenges</h4>
    <div id="challengesList"></div>
    <div id="challengesProgressContainer"></div> <!-- keep existing for yearly goals -->
</section>

<section id="tab-quotes" class="tab-content">
    <h2>Quotes & Highlights</h2>
    <p>Collected memorable quotes from your books.</p>
    <div id="quotesContainer"></div> <!-- We'll render here -->
</section>
 
<section id="tab-options" class="tab-content">
    <h3>Import / Export</h3>
    <label>Import list: <input type="file" id="fileInput" accept=".csv,.json"></label>
    <button id="exportData">Export list</button>
    <button id="clearStorage" style="margin-left:12px;">Clear local list data</button>
    <hr style="border:1px solid #333; margin:16px 0;">
    <div id="generalSettings">
        <h3>General Settings</h3>
        <label><input type="checkbox" id="showNumbers" checked> Show row numbers</label><br><br>
        <label>Min books read for author avg rating: <input type="number" id="minAuthorBooks" min="1" value="2" style="width:80px;"></label><br><br>
        <label><input type="checkbox" id="showYearGoalProgress" checked> Show current year goal progress bar on List tab</label>
    </div>
    <div id="coversSection">
        <h3>Covers Management</h3>
        <p id="coversCount"></p>
        <label><input type="checkbox" id="showCoversTimeline"> Show book covers in Timeline tab</label><br><br>
        <button id="fetchAllCovers">Auto-fetch missing covers from Google Books</button><br><br>
        <button id="clearLocalCovers">Clear all local covers (irreversible)</button>
        <div id="coverCloudButtons" style="display:none;">
            <button id="saveCoversCloud">Save covers to Cloud</button>
            <button id="loadCoversCloud">Load covers from Cloud (overwrite local)</button>
            <button id="deleteCoversCloud" class="danger">Delete covers from Cloud</button>
        </div>
    </div>
    <hr style="border:1px solid #333; margin:16px 0;">
    <h3>Cloud Sync (Firebase - Manual only)</h3>
    <div id="syncStatus" style="margin-bottom:8px; color:#ccc;">Not signed in (local only)</div>
    <input type="email" id="authEmail" placeholder="Email" style="width:200px;"><br>
    <input type="password" id="authPassword" placeholder="Password" style="width:200px;"><br>
    <button id="signInBtn">Sign In</button>
    <button id="signUpBtn" style="margin-left:8px;">Sign Up</button>
    <button id="signOutBtn" style="display:none; margin-left:8px;">Sign Out</button>
    <div id="cloudButtons" style="display:none;">
        <button id="saveCloudBtn">Save to Cloud (overwrite cloud)</button>
        <button id="loadCloudBtn">Load from Cloud (overwrite local)</button>
    </div>
    <hr style="border:1px solid #333; margin:16px 0;">
    <h3>Manage Shelves</h3>
    <div id="shelfManager"></div>
    <hr style="border:1px solid #333; margin:16px 0;">
    Version 1.12! ‚Äì new quotes tab and features! new custom challanges feature! new world map tab and tracking! Big additions all around!
</section>

<div id="editModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); justify-content:center; align-items:center; z-index:1000;">
    <div style="background:#222; padding:20px; border:1px solid #444; max-width:600px; width:100%; max-height:90vh; overflow-y:auto;">
        <h3>Edit Book</h3>
        <div class="edit-section">
            <h4 onclick="this.parentElement.classList.toggle('collapsed')">Basic Info ‚ñº</h4>
            <div class="edit-section-content">
                <label>Title: <input type="text" id="editTitle" style="width:100%;"></label><br>
                <label>Author: <input type="text" id="editAuthor" style="width:100%;"></label><br>
                <label>Series: <input type="text" id="editSeries" style="width:100%;"></label><br>
                <label>Series #: <input type="number" id="editSeriesNumber" step="0.1" style="width:140px;"></label><br>
                <label>Pages: <input type="number" id="editPages"></label><br>
                <label>Year: <input type="number" id="editYear"></label><br>
                <label>Date Added: <input type="date" id="editDateAdded"></label><br>
                <label>Rating (0-5): <input type="number" id="editRating" min="0" max="5"></label><br>
                <label>Favourite book: <input type="checkbox" id="editFavourite"></label><br>
                <label id="favSeriesLabel">Favourite series: <input type="checkbox" id="editFavouriteSeries"></label><br>
            </div>
        </div>
        <div class="edit-section">
            <h4 onclick="this.parentElement.classList.toggle('collapsed')">Metadata ‚ñº</h4>
            <div class="edit-section-content">
                <label>Language: <input type="text" id="editLanguage" style="width:100%;"></label><br>
                <label>Country: <input type="text" id="editCountry" style="width:100%;"></label><br>
                <label>Genre: <input type="text" id="editGenre" style="width:100%;"></label><br>
                <label>Tags (comma separated): <input type="text" id="editTags" style="width:100%;"></label><br>
                <label>Shelves (comma separated): <input type="text" id="editShelves" style="width:100%;"></label><br>
                <label>Status:
                    <select id="editExclusiveShelf">
                        <option value="read">read</option>
                        <option value="currently-reading">currently-reading</option>
                        <option value="to-read">to-read</option>
                        <option value="dnf">dnf</option>
                    </select>
                </label><br>
            </div>
        </div>
        <div class="edit-section">
            <h4 onclick="this.parentElement.classList.toggle('collapsed')">Reads / Re-reads ‚ñº</h4>
            <div class="edit-section-content">
                <div id="readsList"></div>
                <button id="addReadBtn">+ Add Read</button>
                <p style="font-size:0.85em; color:#aaa; margin-top:8px;">
                    Read count is auto-calculated from finished reads.<br>
                    Current read (if status = currently-reading) will have start date but no finish date.
                </p>
            </div>
        </div>
        <div class="edit-section">
            <h4 onclick="this.parentElement.classList.toggle('collapsed')">Cover & Notes ‚ñº</h4>
            <div class="edit-section-content">
                <label>Cover URL: <input type="text" id="editCoverUrl" style="width:100%;"></label>
                <button id="fetchCoverBtn">Auto-fetch from Google Books</button>
                <div style="margin-top:8px;"><img id="coverPreview" style="max-height:250px; max-width:100%; border:1px solid #444;" alt="Cover preview"></div>
                <textarea id="editNotes" placeholder="Notes" style="width:100%; height:100px; resize:vertical; margin-top:12px;"></textarea>
            </div>
        </div>
        <div class="edit-section">
    <h4 onclick="this.parentElement.classList.toggle('collapsed')">Feelings ‚ñº</h4>
    <div class="edit-section-content">
        <p>Quick emojis for this book:</p>
        <div id="emojiPicker" style="font-size:1.8em; cursor:pointer;">
            üôÇ üòê üòû üò≠ üòÇ üò¢ üò° ü§î üî• ‚ùÑÔ∏è üß† üñ§ ‚ú® ‚ù§Ô∏è üéØ üå´Ô∏è ‚òïÔ∏è
        </div>
        <p>Current: <span id="currentEmojis" style="font-size:1.6em;"></span></p>
     <label style="display:block; margin-top:8px;">
    üìç Page for next emoji: <input type="number" id="emojiPageInput" min="1" placeholder="e.g. 150" style="width:120px;">
    <small style="display:block; margin-top:4px; color:#666;">Click emoji to remove ‚Ä¢ Or enter page before clicking to add with page</small>
     </label>
    </div>
</div>
 <div class="edit-section">
    <h4 onclick="this.parentElement.classList.toggle('collapsed')">Quotes & Highlights ‚ñº</h4>
     <div class="edit-section-content">
        <div id="quotesList"></div>
        <button id="addQuoteBtn">+ Add Quote</button>
        <p style="font-size:0.85em; color:#aaa; margin-top:8px;">
            Add memorable passages, thoughts, or highlights. Optional page/date/favorite.
        </p>
    </div>
 </div>
        <div class="modal-footer">
            <button id="removeBook" class="danger">Remove</button>
            <div class="modal-actions-right">
                <button id="saveEdit">Save</button>
                <button id="closeEdit">Close</button>
            </div>
        </div>
    </div>
</div>
</div>

    
<div id="yearReviewModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:flex-start; overflow-y:auto; z-index:1000; padding:20px 0;">
    <div id="yearReviewPanel" style="background:#fff; color:#000; max-width:900px; width:95%; margin:auto; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.5); overflow:hidden;">
        <div id="reviewHeader" style="padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; background:#f8f8f8;">
            <div>
                <h2 style="margin:0;">Year in Review</h2>
                <select id="reviewYearSelect" style="font-size:1em; padding:6px; margin-top:8px;"></select>
            </div>
            <button id="closeYearReview" style="font-size:1.5em; background:none; border:none; cursor:pointer;">√ó</button>
        </div>
        <div id="yearReviewContent" style="padding:20px; min-height:60vh;"></div>
        <div id="reviewFooter" style="padding:20px; border-top:1px solid #eee; text-align:center; background:#f8f8f8;">
            <button id="exportReviewPNG" style="padding:10px 20px; margin:0 10px;">Export as PNG</button>
            <button id="exportReviewPDF" style="padding:10px 20px; margin:0 10px;">Export as PDF</button>
        </div>
    </div>
</div>
<!-- JavaScript files ‚Äì order matters a bit -->
<script src="js/config.js"></script>
<script src="js/state.js"></script>
<script src="js/utils.js"></script>
<script src="js/firebase.js"></script>
<script src="js/import.js"></script>
<script src="js/books.js"></script>
<script src="js/render-list.js"></script>
<script src="js/render-profile.js"></script>
<script src="js/render-stats.js"></script> 
<script src="js/render-quotes.js"></script>
<script src="js/render-timeline.js"></script>
<script src="js/challenges.js"></script>
<script src="js/covers.js"></script>
<script src="js/year-review.js"></script>
<script src="js/ui-core.js"></script>
<script src="js/ui-events.js"></script>
<script src="js/ui-year-review.js"></script>

</body>
</html>
